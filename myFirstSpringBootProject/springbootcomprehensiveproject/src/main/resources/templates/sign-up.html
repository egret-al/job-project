<!doctype html>
<html class="no-js " lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta name="description" content="Responsive Bootstrap 4 and web Application ui kit.">

    <title>注册页面</title>
    <!-- Favicon-->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Custom Css -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/authentication.css">
    <link rel="stylesheet" href="assets/css/color_skins.css">

    <link rel="stylesheet" th:href="@{/assets/plugins/sweetalert/sweetalert.css}" href="../assets/plugins/sweetalert/sweetalert.css"/>

</head>

<body class="theme-purple authentication sidebar-collapse">
<!-- header -->
<nav class="navbar navbar-expand-lg fixed-top navbar-transparent">
    <div class="container">
        <div class="navbar-translate n_logo">
            <span>联系我们</span>
        </div>
        <div class="navbar-collapse">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#">首页</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">查找结果</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" title="Follow us on Twitter" href="#">
                        <i class="zmdi zmdi-twitter"></i>
                        <p class="d-lg-none d-xl-none">Twitter</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" title="Like us on Facebook" href="#">
                        <i class="zmdi zmdi-facebook"></i>
                        <p class="d-lg-none d-xl-none">Facebook</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" title="Follow us on Instagram" href="#">
                        <i class="zmdi zmdi-instagram"></i>
                        <p class="d-lg-none d-xl-none">Instagram</p>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link btn btn-white btn-round" th:href="@{/sign-up}" href="sign-up.html">注册</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!-- main -->
<div class="page-header">
    <div class="page-header-image" style="background-image:url(assets/images/login.jpg)"></div>
    <div class="container">
        <div class="col-md-12 content-center">
            <div class="card-text" style="">
				<!-- 注册表单 -->
                <form class="form" id="registerMerchant" method="post" action="">
                    <div class="header">
                        <h5>实名认证</h5>
                        <small>为了保证您发布职位的真实性，请如实提供信息！</small>
                    </div>
                    <div class="content">
                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="number" class="form-control" placeholder="将要认证的工号（校内I开头，校外O开头）" />
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="password" name="password" class="form-control" placeholder="请输入注册的密码，不少于6位且英文和数字混合" />
                                </div>
                            </div>
                        </div>
                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="realName" class="form-control" placeholder="真实姓名" />
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="identification" class="form-control" placeholder="中国大陆身份证号码" />
                                </div>
                            </div>
                        </div>
                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="sex" class="form-control" placeholder="性别" />
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="nation" class="form-control" placeholder="民族" />
                                </div>
                            </div>
                        </div>
                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="bindEmail" class="form-control" placeholder="绑定邮箱（目前仅支持QQ邮箱）" />
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="currentAddress" class="form-control" placeholder="工作地址" />
                                </div>
                            </div>
                        </div>
                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="organ" class="form-control" placeholder="所属机构、组织" />
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="phone" class="form-control" placeholder="联系电话" />
                                </div>
                            </div>
                        </div>
                        <div class="row clearfix">
                            <div class="col-sm-6">
                                <div class="form-group input-group">
                                    <input type="text" name="bank" class="form-control" placeholder="银行卡" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="footer text-center">
                        <input type="button" id="registerBtn" class="btn btn-primary btn-round btn-lg btn-block waves-effect waves-light" value="注册账户">
                        <h5>
							<a class="link" href="sign-in.html">去登录</a>
						</h5>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<script th:src="@{/assets/plugins/sweetalert/sweetalert.min.js}" src="../assets/plugins/sweetalert/sweetalert.min.js"></script> <!-- SweetAlert Plugin Js -->
<!-- Jquery Core Js -->
<script src="assets/bundles/libscripts.bundle.js"></script>
<!-- Lib Scripts Plugin Js -->
<script src="assets/bundles/vendorscripts.bundle.js"></script>
<script>
    $("#registerBtn").click(function () {
        var number = $("input[name='number']").val();
        var password = $("input[name='password']").val();
        var realName = $("input[name='realName']").val();
        var identification = $("input[name='identification']").val();
        var sex = $("input[name='sex']").val();
        var nation = $("input[name='nation']").val();
        var bindEmail = $("input[name='bindEmail']").val();
        var organ = $("input[name='organ']").val();
        var currentAddress = $("input[name='currentAddress']").val();
        var phone = $("input[name='phone']").val();
        var bank = $("input[name='bank']").val();


        //验证身份证号码的正则表达式
        const verifyId = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
        //验证手机号码
        const verifyPhone = /^1[3456789]\d{9}$/;
        //验证邮箱
        const verifyEmail = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;
        //简单验证银行卡
        const verifyCredit = /^\d{16}$/;

        //验证
        if (number === "" || password === "" || realName === "" || identification === "" || sex === "" || nation === "" ||
                bindEmail === "" || organ === "" || currentAddress === "" || phone === "" || bank === "") {
            alert("信息不完整！");
            return;
        }
        if ((number[0] === 'O' || number[0] === 'I') && (number.length === 10)) {
            //账号验证通过
            if (password.length < 6) {
                showErrorMessage("密码不符合要求！");
                $("input[name='password']").val("");
                return;
            }
            if (!verifyId.test(identification)) {
                showErrorMessage("身份证非法！");
                $("input[name='identification']").val("");
                return;
            }
            if (sex === "男" || sex === "女") {
                if (!verifyEmail.test(bindEmail)) {
                    showErrorMessage("邮箱格式错误！")
                    $("input[name='bindEmail']").val("");
                    return;
                }
                if (!verifyPhone.test(phone)) {
                    showErrorMessage("手机号码非法！")
                    $("input[name='phone']").val("");
                    return;
                }
                if (!verifyCredit.test(bank)) {
                    showErrorMessage("银行卡错误！");
                    $("input[name='bank']").val("");
                    return;
                }
                //验证通过，发送请求
                var data = {
                    number: number,
                    password: password,
                    realName: realName,
                    identification: identification,
                    sex: sex,
                    nation: nation,
                    bindEmail: bindEmail,
                    organ: organ,
                    currentAddress: currentAddress,
                    phone: phone,
                    bank: bank
                };
                $.ajax({
                    type: 'POST',
                    url: '/registerMerchantAboutInfo',
                    dataType: 'json',
                    contentType: "application/json;charset=UTF-8",
                    data: JSON.stringify(data),
                    success: function (data) {
                        console.log("success：" + data);
                        showSuccessMessage(data.msg);
                    },
                    error: function (data) {
                        showErrorMessage("注册失败");
                    }
                })
            } else {
                showErrorMessage("信息错误！");
                $("input[name='sex']").val("");
            }
        } else {
            showErrorMessage("格式错误！");
            $("input[name='number']").val("");
        }
    })
    function showSuccessMessage(data) {
        swal("成功！", data, "success");
    }

    function showErrorMessage(data) {
        swal({
            title: "失败",
            text: data,
            type: "error",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            closeOnConfirm: false
        });
    }

    function showWarningMessage(data) {
        swal({
            title: "警告",
            text: data,
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            closeOnConfirm: false
        });
    }
</script>
</html>