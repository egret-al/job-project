<!doctype html>
<html class="no-js " lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <meta name="description" content="Responsive Bootstrap 4 and web Application ui kit.">

    <title>商家信息</title>
    <link rel="icon" th:href="@{/favicon.ico}" href="../favicon.ico" type="image/x-icon">
    <!-- Favicon-->
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap/css/bootstrap.min.css}" href="../assets/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/assets/plugins/morrisjs/morris.css}" href="../assets/plugins/morrisjs/morris.css"/>

    <!-- Colorpicker Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.css}" href="../assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.css" />
    <!-- Multi Select Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/multi-select/css/multi-select.css}" href="../assets/plugins/multi-select/css/multi-select.css">
    <!-- Bootstrap Spinner Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/jquery-spinner/css/bootstrap-spinner.css}" href="../assets/plugins/jquery-spinner/css/bootstrap-spinner.css">
    <!-- Bootstrap Tagsinput Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css}" href="../assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css">
    <!-- Bootstrap Select Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-select/css/bootstrap-select.css}" href="../assets/plugins/bootstrap-select/css/bootstrap-select.css" />
    <!-- noUISlider Css -->
    <link rel="stylesheet" th:href="@{/assets/plugins/nouislider/nouislider.min.css}" href="../assets/plugins/nouislider/nouislider.min.css" />

    <link rel="stylesheet" th:href="@{/assets/plugins/sweetalert/sweetalert.css}" href="../assets/plugins/sweetalert/sweetalert.css"/>

    <link rel="stylesheet" th:href="@{/assets/plugins/footable-bootstrap/css/footable.bootstrap.min.css}" href="../assets/plugins/footable-bootstrap/css/footable.bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/assets/plugins/footable-bootstrap/css/footable.standalone.min.css}" href="../assets/plugins/footable-bootstrap/css/footable.standalone.min.css">
    <!-- Custom Css -->
    <link rel="stylesheet" th:href="@{/assets/css/main.css}" href="../assets/css/main.css">
    <link rel="stylesheet" th:href="@{/assets/css/hm-style.css}" href="../assets/css/hm-style.css">
    <link rel="stylesheet" th:href="@{/assets/css/color_skins.css}" href="../assets/css/color_skins.css">
</head>

<body class="theme-purple index2">
<!-- Page Loader -->
<div class="page-loader-wrapper">
    <div class="loader">
        <div class="m-t-30"><img class="zmdi-hc-spin" th:src="@{/assets/images/logo.svg}" src="../assets/images/logo.svg" width="48" height="48" alt="Oreo"></div>
        <p>Please wait...</p>        
    </div>
</div>

<!-- Overlay For Sidebars -->
<div class="overlay"></div>

<!-- 上方工具栏 -->
<nav class="navbar p-l-5 p-r-5">
    <ul class="nav navbar-nav navbar-left">
        <li>
            <div class="navbar-header">
                <a href="javascript:void(0);" class="bars"></a>
                <img th:src="@{/assets/images/logo.svg}" src="../assets/images/logo.svg" width="30" alt="Oreo">
                <span class="m-l-10" style="color: white">管理员页面</span>
            </div>
        </li>
        <li class="hidden-md-down">
            <a href="javascript:void(0)" title="Events">
                <i class="zmdi zmdi-calendar"></i>
            </a>
        </li>
        <li class="hidden-md-down">
            <a href="javascript:void(0)" title="Inbox">
                <i class="zmdi zmdi-email"></i>
            </a>
        </li>
        <li>
            <a href="javascript:void(0)" title="Contact List">
                <i class="zmdi zmdi-account-box-phone"></i>
            </a>
        </li>
        <li class="hidden-sm-down">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search...">
                <span class="input-group-addon">
                    <i class="zmdi zmdi-search"></i>
                </span>
            </div>
        </li>
        <li class="float-right">
            <a href="javascript:void(0);" class="fullscreen hidden-sm-down" data-provide="fullscreen" data-close="true"><i class="zmdi zmdi-fullscreen"></i></a>
            <a th:href="@{/logout}" href="../sign-in.html" class="mega-menu" data-close="true"><i class="zmdi zmdi-power"></i></a>
            <a href="javascript:void(0);" class="js-right-sidebar" data-close="true"><i class="zmdi zmdi-settings zmdi-hc-spin"></i></a>
        </li>
    </ul>
</nav>

<!--横向菜单栏-->
<div class="menu-container">
    <div class="menu">
        <ul class="pullDown">
            <li><a th:href="@{/index}" href="javascript:void(0)">首页</a>
                <ul class="pullDown">
                    <li><a th:href="@{/index}" href="index-admin.html">主页</a> </li>
                </ul>
            </li>
            <li><a href="javascript:void(0)">商家功能</a>
                <ul class="pullDown">
                    <li><a th:href="@{/admin/list-job}" href="javascript:void(0)">批准审核</a> </li>
                    <li><a th:href="@{/admin/list-merchant}" href="javascript:void(0)">商家列表</a> </li>
                </ul>
            </li>
            <li><a href="javascript:void(0)">学生功能</a>
                <ul class="pullDown">
                    <li> <a th:href="@{/admin/list-student}" href="#" >学生列表</a> </li>
                    <li> <a th:href="@{/admin/add-student}" href="add-student.html" >注册学籍</a> </li>
                </ul>
            </li>
            <li><a href="javascript:void(0)">个人相关</a>
                <ul class="pullDown">
                    <li><a href="javascript:void(0)">我的信息</a></li>
                    <li><a href="javascript:void(0)">修改密码</a></li>
                </ul>
            </li>
            <li><a href="javascript:void(0)">校方功能</a>
                <ul class="pullDown">
                    <li> <a href="javascript:void(0)" >功能1</a></li>
                    <li> <a href="javascript:void(0)" >功能2</a></li>
                    <li> <a href="javascript:void(0)" >功能3</a></li>
                    <li> <a href="javascript:void(0)" >功能4</a></li>
                </ul>
            </li>
            <li><a href="javascript:void(0)">学校公告</a>
                <ul class="pullDown">
                    <li><a href="javascript:void(0)">公告1</a></li>
                    <li><a href="javascript:void(0)">公告2</a></li>
                </ul>
            </li>
            <li><a href="javascript:void(0)">关于我们 </a>
                <ul class="pullDown">
                    <li><a href="javascript:void(0)">版权所有</a> </li>
                </ul>
            </li>
        </ul>
    </div>
</div>

<!-- 右侧边栏 -->
<aside id="rightsidebar" class="right-sidebar">
    <ul class="nav nav-tabs">
        <!--设置图标-->
        <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#setting">
                <i class="zmdi zmdi-settings zmdi-hc-spin"></i>
            </a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane slideRight active" id="setting">
            <div class="slim_scroll">
                <div class="card">
                    <h6>普通设置</h6>
                    <ul class="setting-list list-unstyled">
                        <li>
                            <div class="checkbox">
                                <input id="checkbox1" type="checkbox">
                                <label for="checkbox1">Report Panel Usage</label>
                            </div>
                        </li>
                        <li>
                            <div class="checkbox">
                                <input id="checkbox2" type="checkbox" checked="">
                                <label for="checkbox2">Email Redirect</label>
                            </div>
                        </li>
                        <li>
                            <div class="checkbox">
                                <input id="checkbox3" type="checkbox" checked="">
                                <label for="checkbox3">Notifications</label>
                            </div>
                        </li>
                        <li>
                            <div class="checkbox">
                                <input id="checkbox4" type="checkbox" checked="">
                                <label for="checkbox4">Auto Updates</label>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="card">
                    <h6>主题设置</h6>
                    <ul class="choose-skin list-unstyled">
                        <li data-theme="purple" class="active">
                            <div class="purple"></div>
                        </li>
                        <li data-theme="blue">
                            <div class="blue"></div>
                        </li>
                        <li data-theme="cyan">
                            <div class="cyan"></div>
                        </li>
                        <li data-theme="green">
                            <div class="green"></div>
                        </li>
                        <li data-theme="orange">
                            <div class="orange"></div>
                        </li>
                        <li data-theme="blush">
                            <div class="blush"></div>
                        </li>
                    </ul>
                </div>
                <div class="card">
                    <h6>账户设置</h6>
                    <ul class="setting-list list-unstyled">
                        <li>
                            <div class="checkbox">
                                <input id="checkbox5" type="checkbox" checked="">
                                <label for="checkbox5">Offline</label>
                            </div>
                        </li>
                        <li>
                            <div class="checkbox">
                                <input id="checkbox6" type="checkbox" checked="">
                                <label for="checkbox6">Location Permission</label>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="card theme-light-dark">
                    <h6>菜单风格</h6>
                    <button class="t-light btn btn-default btn-simple btn-round btn-block">Light</button>
                    <button class="t-dark btn btn-default btn-round btn-block">Dark</button>
                    <button class="m_img_btn btn btn-primary btn-round btn-block">Sidebar Image</button>
                </div>
            </div>
        </div>
    </div>
</aside>

<section class="content">
    <div class="block-header">
        <div class="row">
            <div class="col-lg-7 col-md-6 col-sm-12">
                <h2>管理员首页
                <small th:text="${session.loginUser.name}">管理员名字</small>
                </h2>
            </div>
            <div class="col-lg-5 col-md-6 col-sm-12">
                <button class="btn btn-white btn-icon btn-round hidden-sm-down float-right m-l-10" type="button">
                    <i class="zmdi zmdi-plus"></i>
                </button>
                <ul class="breadcrumb float-md-right">
                    <li class="breadcrumb-item"><a href="index-admin.html"><i class="zmdi zmdi-home"></i>刷新</a></li>
                    <li class="breadcrumb-item active">学生信息</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row clearfix">
            <div class="col-lg-12">
                <div class="card">
                    <div class="body">
                        <div class="row">
                            <div class="details col-lg-12 col-md-12">
                                <div class="row">
                                    <div class="col-lg-6 col-md-12" id="dName">姓名：[[${student.name}]]</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">学校：[[${student.subsidiaryOrgan}]]</div>
                                    <div class="col-lg-6 col-md-12">性别：[[${student.gender}]]</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12">民族：[[${student.nation}]]</div>
                                    <div class="col-lg-6 col-md-12">身份证号码：[[${student.identification}]]</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12" id="dEmail">绑定邮箱：[[${student.email}]]</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-lg-6 col-md-12" id="dPhone">联系电话：[[${student.phone}]]</div>
                                    <div class="col-lg-6 col-md-12" id="dAddress">家庭住址：[[${student.currentAddress}]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card">
                    <ul class="nav nav-tabs">
                        <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#description">信息设置</a></li>
                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#review">账户设置</a></li>
                    </ul>
                </div>
                <div class="card">
                    <div class="body">
                        <div class="tab-content">
                            <div class="tab-pane active" id="description">
                                <form class="form-horizontal">
                                    <div class="row clearfix">
                                        <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                            <label for="realName">姓名：</label>
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-8">
                                            <div class="form-group">
                                                <input type="text" th:value="${student.name}" id="realName" class="form-control" placeholder="真实姓名">
                                            </div>
                                        </div>
                                        <input type="hidden" id="sId" th:value="${student.id}">
                                    </div>

                                    <div class="row clearfix">
                                        <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                            <label for="bindEmail">绑定邮箱：</label>
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-8">
                                            <div class="form-group">
                                                <input type="text" th:value="${student.email}" id="bindEmail" class="form-control" placeholder="绑定邮箱">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row clearfix">
                                        <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                            <label for="phone">联系电话：</label>
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-8">
                                            <div class="form-group">
                                                <input type="text" id="phone" th:value="${student.phone}" class="form-control" placeholder="联系电话">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row clearfix">
                                        <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                            <label for="homeAddress">家庭地址：</label>
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-8">
                                            <div class="input-group">
                                                <input type="text" id="homeAddress" th:value="${student.currentAddress}" name="homeAddress" class="form-control" placeholder="地址">
                                            </div>
                                        </div>
                                    </div>

                                    <button type="button" id="modifyInfo" class="btn btn-raised btn-primary btn-round waves-effect" data-type="success">确认修改</button>
                                </form>
                            </div>
                            <div class="tab-pane" id="review">
                                <div class="row clearfix">
                                    <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                        <label for="studentNum">学号：</label>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-8">
                                        <div class="input-group">
                                            <input type="text" th:value="${account.username}" id="studentNum" readonly="readonly" name="studentNum" class="form-control" placeholder="学号">
                                        </div>
                                    </div>
                                </div>
                                <div class="row clearfix">
                                    <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                        <label for="currentPassword">当前密码：</label>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-8">
                                        <div class="input-group">
                                            <input type="text" th:value="${account.password}" id="currentPassword" readonly="readonly" name="currentPassword" class="form-control" placeholder="当前密码">
                                        </div>
                                    </div>
                                </div>
                                <div class="row clearfix">
                                    <div class="col-lg-1 col-md-1 col-sm-4 form-control-label">
                                        <label for="newPassword">新密码：</label>
                                    </div>
                                    <div class="col-lg-4 col-md-4 col-sm-8">
                                        <div class="input-group">
                                            <input type="text" id="newPassword" name="newPassword" class="form-control" placeholder="新密码">
                                        </div>
                                    </div>
                                </div>

                                <button type="button" id="modifyPassword" class="btn btn-raised btn-primary btn-round waves-effect" data-type="success">确认修改</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Jquery Core Js --> 
<script th:src="@{/assets/bundles/libscripts.bundle.js}" src="../assets/bundles/libscripts.bundle.js"></script> <!-- Lib Scripts Plugin Js -->
<script th:src="@{/assets/bundles/vendorscripts.bundle.js}" src="../assets/bundles/vendorscripts.bundle.js"></script> <!-- Lib Scripts Plugin Js -->

<script th:src="@{/assets/bundles/index.bundle.js}" src="../assets/bundles/index.bundle.js"></script> <!-- Jquery Knob, Count To, Sparkline Js -->
<script th:src="@{/assets/bundles/morrisscripts.bundle.js}" src="../assets/bundles/morrisscripts.bundle.js"></script><!-- Morris Plugin Js -->
<script th:src="@{/assets/bundles/footable.bundle.js}" src="../assets/bundles/footable.bundle.js"></script> <!-- Lib Scripts Plugin Js -->

<script th:src="@{/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js}" src="../assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script> <!-- Bootstrap Colorpicker Js -->
<script th:src="@{/assets/plugins/jquery-inputmask/jquery.inputmask.bundle.js}" src="../assets/plugins/jquery-inputmask/jquery.inputmask.bundle.js"></script> <!-- Input Mask Plugin Js -->
<script th:src="@{/assets/bundles/mainscripts.bundle.js}" src="../assets/plugins/multi-select/js/jquery.multi-select.js"></script> <!-- Multi Select Plugin Js -->
<script th:src="@{/assets/plugins/multi-select/js/jquery.multi-select.js}" src="../assets/plugins/jquery-spinner/js/jquery.spinner.js"></script> <!-- Jquery Spinner Plugin Js -->
<script th:src="@{/assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.js}" src="../assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.js"></script> <!-- Bootstrap Tags Input Plugin Js -->
<script th:src="@{/assets/plugins/nouislider/nouislider.js}" src="../assets/plugins/nouislider/nouislider.js"></script> <!-- noUISlider Plugin Js -->

<script th:src="@{/assets/plugins/sweetalert/sweetalert.min.js}" src="../assets/plugins/sweetalert/sweetalert.min.js"></script> <!-- SweetAlert Plugin Js -->

<script th:src="@{/assets/bundles/mainscripts.bundle.js}" src="../assets/bundles/mainscripts.bundle.js"></script><!-- Custom Js -->
<script th:src="@{/assets/js/pages/forms/advanced-form-elements.js}" src="../assets/js/pages/forms/advanced-form-elements.js"></script>

<script th:src="@{/assets/bundles/mainscripts.bundle.js}" src="../assets/bundles/mainscripts.bundle.js"></script>
<script th:src="@{/assets/js/pages/charts/jquery-knob.js}" src="../assets/js/pages/charts/jquery-knob.js"></script>
<script th:src="@{/assets/js/pages/charts/chart.min.js}" src="../assets/js/pages/charts/chart.min.js"></script>

<script th:src="@{/assets/js/pages/tables/footable.js}" src="../assets/js/pages/tables/footable.js"></script><!-- Custom Js -->
<script>
    /*global $ */
    $(document).ready(function() {
        "use strict";
        $('.menu > ul > li:has( > ul)').addClass('menu-dropdown-icon');
        //Checks if li has sub (ul) and adds class for toggle icon - just an UI

        $('.menu > ul > li > ul:not(:has(ul))').addClass('normal-sub');

        $(".menu > ul > li").hover(function(e) {
            if ($(window).width() > 943) {
                $(this).children("ul").stop(true, false).fadeToggle(150);
                e.preventDefault();
            }
        });
        //If width is more than 943px dropdowns are displayed on hover
        $(".menu > ul > li").click(function() {
            if ($(window).width() <= 943) {
                $(this).children("ul").fadeToggle(150);
            }
        });
        //If width is less or equal to 943px dropdowns are displayed on click (thanks Aman Jain from stackoverflow)

        $("#modifyInfo").click(function () {
            showConfirmMessage();
        });

        function showSuccessMessage(data) {
            swal("操作成功！", data, "success");
        }

        //验证手机号码
        const verifyPhone = /^1[3456789]\d{9}$/;
        //验证邮箱
        const verifyEmail = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;

        function showErrorMessage(data) {
            swal({
                title: "失败",
                text: data,
                type: "error",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                closeOnConfirm: false
            });
        }

        $("#modifyPassword").click(function () {
            const newPassword = $("#newPassword").val().trim();
            const username = $("#studentNum").val().trim();
            if (newPassword === "") {
                showErrorMessage("不能为空！");
            } else {
                let data = {newPassword: newPassword, username: username};
                $.ajax({
                    type: 'POST',
                    url: '/admin/modifyStudentPassword',
                    dataType: 'json',
                    data: data,
                    success: function (data) {
                        $("#currentPassword").val(newPassword);
                        showSuccessMessage(data.msg);
                    },
                    error: function (data) {
                        showErrorMessage(data.msg);
                    }
                })
            }
        });

        function showConfirmMessage() {
            swal({
                title: "你确定要修改信息吗？",
                text: "该修改是不可逆转的，是否继续？",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "confirm",
                closeOnConfirm: false
            }, function () {
                const newEmail = $("#bindEmail").val().trim();
                const newName = $("#realName").val().trim();
                const newPhone = $("#phone").val().trim();
                const newAddress = $("#homeAddress").val().trim();
                const sId = $("#sId").val();

                if (verifyEmail.test(newEmail)) {
                    if (verifyPhone.test(newPhone)) {
                        if (newName === "" || newAddress === "") {
                            showErrorMessage("信息不完整！");
                        } else {
                            var data = {newEmail: newEmail, newName: newName, newPhone: newPhone, newAddress: newAddress, sId: sId};
                            $.ajax({
                                type: 'POST',
                                url: '/admin/modifyStudentInfo',
                                dataType: 'json',
                                data: data,
                                success: function (data) {
                                    //数据库修改成功，同步页面
                                    $("#dEmail").text("绑定邮箱：" + newEmail);
                                    $("#dName").text("姓名：" + newName);
                                    $("#dPhone").text("联系电话：" + newPhone);
                                    $("#dAddress").text("家庭地址：" + newAddress);
                                    showSuccessMessage(data.msg);
                                },
                                error: function (data) {
                                    showErrorMessage(data)
                                }
                            })
                        }
                    } else {
                        showErrorMessage("手机号码非法！")
                    }
                } else {
                    showErrorMessage("邮箱非法！")
                }
            });
        }

    });
</script>
</body>
</html>